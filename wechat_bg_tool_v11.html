
<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>微信聊天背景调整工具 · 第11版</title>
<style>
  :root{
    --wx: #09bb07;
  }
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f0f2f5;color:#333;}
  header{background:var(--wx);color:#fff;text-align:center;padding:16px 12px;}
  header h1{margin:0;font-size:20px;letter-spacing:1px;}
  .wrap{padding:16px;max-width:980px;margin:0 auto;}
  .card{background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.06);padding:16px;margin-bottom:16px;}
  .row{display:flex;flex-wrap:wrap;gap:16px;align-items:center;justify-content:center;}
  input[type=file]{padding:10px;border:1px solid #ddd;border-radius:8px;background:#fff}
  canvas{border:2px solid var(--wx);border-radius:10px;max-width:100%;height:auto;background:#fff}
  .btn{background:var(--wx);color:#fff;border:none;border-radius:8px;padding:10px 14px;font-size:16px;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .ghost{background:#fff;color:var(--wx);border:1px solid var(--wx)}
  .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center;margin-top:10px}
  .controls label{font-size:14px;color:#555}
  input[type=range]{width:220px}
  #download{display:none;text-decoration:none}
  .preview{padding:0 8px 12px}
  .phone{width:375px;height:812px;margin:0 auto;border:1px solid #ddd;border-radius:22px;background:#fff;position:relative;overflow:hidden}
  .phone .bg{position:absolute;inset:0}
  .overlay-top,.overlay-bottom{position:absolute;left:0;right:0;background:rgba(255,255,255,.85)}
  .overlay-top{top:0;height:96px}
  .overlay-bottom{bottom:0;height:120px}
  .tip{font-size:12px;color:#888;margin-top:6px;text-align:center}
</style>
</head>
<body>
<header><h1>微信聊天背景调整工具 · 第11版参数</h1></header>

<div class="wrap">
  <div class="card">
    <div class="row">
      <input id="file" type="file" accept="image/*" />
      <a id="download" class="btn" download="wechat_bg_v11.jpg">下载图片</a>
      <button id="reset" class="btn ghost">重置到第11版</button>
    </div>
    <div class="controls">
      <button id="up" class="btn">上移 10px</button>
      <button id="down" class="btn">下移 10px</button>
      <label>缩放：<span id="scaleLabel">100%</span></label>
      <input id="scale" type="range" min="100" max="200" value="100" />
    </div>
  </div>

  <div class="card">
    <canvas id="cvs" width="1206" height="2622"></canvas>
    <div class="tip">输出画布：1206×2622，顶部留白420，底部留白150，默认上移119px（可微调）</div>
  </div>

  <div class="card preview">
    <div class="phone">
      <img id="preview" class="bg" alt="预览" />
      <div class="overlay-top"></div>
      <div class="overlay-bottom"></div>
    </div>
    <div class="tip">仅为视觉预览，手机实际UI高度可能略有差异</div>
  </div>
</div>

<script>
// —— 第11版固定参数 ——
const TARGET_W = 1206;
const TARGET_H = 2622;
const TOP = 420;
const BOTTOM = 150;
const SAFE_H = TARGET_H - TOP - BOTTOM; // 2052
const DEFAULT_Y_NUDGE = -119; // 上移119px（负值）

const fileInput = document.getElementById('file');
const cvs = document.getElementById('cvs');
const ctx = cvs.getContext('2d');
const downloadA = document.getElementById('download');
const upBtn = document.getElementById('up');
const downBtn = document.getElementById('down');
const resetBtn = document.getElementById('reset');
const scaleRange = document.getElementById('scale');
const scaleLabel = document.getElementById('scaleLabel');
const previewImg = document.getElementById('preview');

let img = null;
let yNudge = DEFAULT_Y_NUDGE; // 可由按钮微调
let userScale = 1.0;          // 100% = 1.0

function draw() {
  if (!img) return;

  // 清空画布 & 白底
  ctx.fillStyle = '#FFFFFF';
  ctx.fillRect(0, 0, TARGET_W, TARGET_H);

  // 原图宽高及比例
  const iw = img.width;
  const ih = img.height;
  const imgRatio = iw / ih;
  const targetRatio = TARGET_W / SAFE_H;

  // —— 第11版缩放逻辑（以安全区为基准铺满） ——
  let newW, newH;
  if (imgRatio > targetRatio) {
    // 图片更“宽”，按安全区高度缩放到 2052px
    newH = SAFE_H;
    newW = Math.round(newH * imgRatio);
  } else {
    // 图片更“窄”，按宽度缩放到 1206px
    newW = TARGET_W;
    newH = Math.round(newW / imgRatio);
  }

  // 用户缩放（在第11版基础上做比例放大/缩小）
  newW = Math.round(newW * userScale);
  newH = Math.round(newH * userScale);

  // 计算粘贴位置：水平居中，垂直=安全区居中 + yNudge
  const x = Math.floor((TARGET_W - newW) / 2);
  const y = Math.floor(TOP + (SAFE_H - newH) / 2 + yNudge);

  // 绘制（超出画布会被裁切）
  ctx.drawImage(img, x, y, newW, newH);

  // 下载链接 & 预览
  const dataURL = cvs.toDataURL('image/jpeg', 0.95);
  downloadA.href = dataURL;
  downloadA.style.display = 'inline-block';
  previewImg.src = dataURL;
}

fileInput.addEventListener('change', (e) => {
  const f = e.target.files[0];
  if (!f) return;
  const image = new Image();
  image.onload = () => { img = image; draw(); };
  image.src = URL.createObjectURL(f);
});

upBtn.addEventListener('click', () => { yNudge -= 10; draw(); });
downBtn.addEventListener('click', () => { yNudge += 10; draw(); });

scaleRange.addEventListener('input', (e) => {
  userScale = Number(e.target.value) / 100;
  scaleLabel.textContent = Math.round(userScale * 100) + '%';
  draw();
});

resetBtn.addEventListener('click', () => {
  yNudge = DEFAULT_Y_NUDGE;
  userScale = 1.0;
  scaleRange.value = 100;
  scaleLabel.textContent = '100%';
  draw();
});
</script>
</body>
</html>
